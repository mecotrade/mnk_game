from contexts import ContextTree
from tictactoe import TicTacToe


class TicTacToe3D(TicTacToe):

    DEPTH = 3
    NUM_ACTIONS = TicTacToe.WIDTH * TicTacToe.HEIGHT * DEPTH

    WIN_POSITIONS = [
        # level 1
        #             |           |
        0b_000_000_000_000_000_000_000_000_111,
        0b_000_000_000_000_000_000_000_111_000,
        0b_000_000_000_000_000_000_111_000_000,
        0b_000_000_000_000_000_000_001_001_001,
        0b_000_000_000_000_000_000_010_010_010,
        0b_000_000_000_000_000_000_100_100_100,
        0b_000_000_000_000_000_000_100_010_001,
        0b_000_000_000_000_000_000_001_010_100,
        # level 2
        #             |           |
        0b_000_000_000_000_000_111_000_000_000,
        0b_000_000_000_000_111_000_000_000_000,
        0b_000_000_000_111_000_000_000_000_000,
        0b_000_000_000_001_001_001_000_000_000,
        0b_000_000_000_010_010_010_000_000_000,
        0b_000_000_000_100_100_100_000_000_000,
        0b_000_000_000_100_010_001_000_000_000,
        0b_000_000_000_001_010_100_000_000_000,
        # level 3
        #             |           |
        0b_000_000_111_000_000_000_000_000_000,
        0b_000_111_000_000_000_000_000_000_000,
        0b_111_000_000_000_000_000_000_000_000,
        0b_001_001_001_000_000_000_000_000_000,
        0b_010_010_010_000_000_000_000_000_000,
        0b_100_100_100_000_000_000_000_000_000,
        0b_100_010_001_000_000_000_000_000_000,
        0b_001_010_100_000_000_000_000_000_000,
        # vertical
        #             |           |
        0b_000_000_001_000_000_001_000_000_001,
        0b_000_000_010_000_000_010_000_000_010,
        0b_000_000_100_000_000_100_000_000_100,
        0b_000_001_000_000_001_000_000_001_000,
        0b_000_010_000_000_010_000_000_010_000,
        0b_000_100_000_000_100_000_000_100_000,
        0b_001_000_000_001_000_000_001_000_000,
        0b_010_000_000_010_000_000_010_000_000,
        0b_100_000_000_100_000_000_100_000_000,
        # xz-diagonal
        #             |           |
        0b_000_000_100_000_000_010_000_000_001,
        0b_000_100_000_000_010_000_000_001_000,
        0b_100_000_000_010_000_000_001_000_000,
        0b_000_000_001_000_000_010_000_000_100,
        0b_000_001_000_000_010_000_000_100_000,
        0b_001_000_000_010_000_000_100_000_000,
        # yz-diagonal
        #             |           |
        0b_001_000_000_000_001_000_000_000_001,
        0b_010_000_000_000_010_000_000_000_010,
        0b_100_000_000_000_100_000_000_000_100,
        0b_000_000_001_000_001_000_001_000_000,
        0b_000_000_010_000_010_000_010_000_000,
        0b_000_000_100_000_100_000_100_000_000,
        # xyz-diagonal
        #             |           |
        0b_100_000_000_000_010_000_000_000_001,
        0b_001_000_000_000_010_000_000_000_100,
        0b_000_000_100_000_010_000_001_000_000,
        0b_000_000_001_000_010_000_100_000_000
    ]

    @classmethod
    def shape(cls):
        return cls.WIDTH, cls.HEIGHT, cls.DEPTH, 3

    def print_board(self):
        board_x, board_o = self.board
        _, position_x = self.calculate_reward(board_x)
        _, position_o = self.calculate_reward(board_o)
        cells = self.cells_for_board(board_x, board_o, position_x, position_o, self.actions)
        border_line = '+'.join(['---'] * self.WIDTH)
        print('+' + '+   +'.join([border_line] * self.DEPTH) + '+')
        for row in range(self.HEIGHT):
            table_rows = list()
            for level in range(self.DEPTH):
                offset = level * self.WIDTH * self.HEIGHT + row * self.WIDTH
                table_rows.append('|'.join(cells[offset:offset + self.WIDTH]))
            print('|' + '|   |'.join(table_rows) + '|')
            print('+' + '+   +'.join([border_line] * self.DEPTH) + '+')


class TicTacToe3DTree(TicTacToe3D, ContextTree):
    pass


class Qubic(TicTacToe3D):
    WIDTH = 4
    HEIGHT = 4
    DEPTH = 4
    NUM_ACTIONS = WIDTH * HEIGHT * DEPTH

    WIN_POSITIONS = [
        # level 1
        #                     |                   |                   |
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1111,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1111_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1111_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1111_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0001_0001_0001_0001,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0010_0010_0010_0010,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0100_0100_0100_0100,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1000_1000_1000_1000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1000_0100_0010_0001,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0001_0010_0100_1000,
        # level 2
        #                     |                   |                   |
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1111_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_1111_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0000_1111_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_1111_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0001_0001_0001_0001_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0010_0010_0010_0010_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0100_0100_0100_0100_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_1000_1000_1000_1000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_1000_0100_0010_0001_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_0000_0000_0001_0010_0100_1000_0000_0000_0000_0000,
        # level 3
        #                     |                   |                   |
        0b_0000_0000_0000_0000_0000_0000_0000_1111_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_0000_1111_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0000_1111_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_1111_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0001_0001_0001_0001_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0010_0010_0010_0010_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0100_0100_0100_0100_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_1000_1000_1000_1000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_1000_0100_0010_0001_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_0000_0000_0001_0010_0100_1000_0000_0000_0000_0000_0000_0000_0000_0000,
        # level 4
        #                     |                   |                   |
        0b_0000_0000_0000_1111_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_0000_1111_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0000_1111_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_1111_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0001_0001_0001_0001_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0010_0010_0010_0010_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0100_0100_0100_0100_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_1000_1000_1000_1000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_1000_0100_0010_0001_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        0b_0001_0010_0100_1000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000,
        # vertical
        #                     |                   |                   |
        0b_0000_0000_0000_0001_0000_0000_0000_0001_0000_0000_0000_0001_0000_0000_0000_0001,
        0b_0000_0000_0000_0010_0000_0000_0000_0010_0000_0000_0000_0010_0000_0000_0000_0010,
        0b_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000_0100,
        0b_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000,
        0b_0000_0000_0001_0000_0000_0000_0001_0000_0000_0000_0001_0000_0000_0000_0001_0000,
        0b_0000_0000_0010_0000_0000_0000_0010_0000_0000_0000_0010_0000_0000_0000_0010_0000,
        0b_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000_0100_0000,
        0b_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000,
        0b_0000_0001_0000_0000_0000_0001_0000_0000_0000_0001_0000_0000_0000_0001_0000_0000,
        0b_0000_0010_0000_0000_0000_0010_0000_0000_0000_0010_0000_0000_0000_0010_0000_0000,
        0b_0000_0100_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000,
        0b_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000,
        0b_0001_0000_0000_0000_0001_0000_0000_0000_0001_0000_0000_0000_0001_0000_0000_0000,
        0b_0010_0000_0000_0000_0010_0000_0000_0000_0010_0000_0000_0000_0010_0000_0000_0000,
        0b_0100_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000,
        0b_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000,
        # xz diagonal
        #                     |                   |                   |
        0b_0000_0000_0000_1000_0000_0000_0000_0100_0000_0000_0000_0010_0000_0000_0000_0001,
        0b_0000_0000_1000_0000_0000_0000_0100_0000_0000_0000_0010_0000_0000_0000_0001_0000,
        0b_0000_1000_0000_0000_0000_0100_0000_0000_0000_0010_0000_0000_0000_0001_0000_0000,
        0b_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000_1000_0000_0000_0000,
        0b_0000_0000_0000_0001_0000_0000_0000_0010_0000_0000_0000_0100_0000_0000_0000_1000,
        0b_0000_0000_0001_0000_0000_0000_0010_0000_0000_0000_0100_0000_0000_0000_1000_0000,
        0b_0000_0001_0000_0000_0000_0010_0000_0000_0000_0100_0000_0000_0000_1000_0000_0000,
        0b_0001_0000_0000_0000_0100_0000_0000_0000_0100_0000_0000_0000_1000_0000_0000_0000,
        # yz diagonal
        #                     |                   |                   |
        0b_0001_0000_0000_0000_0000_0001_0000_0000_0000_0000_0001_0000_0000_0000_0000_0001,
        0b_0010_0000_0000_0000_0000_0010_0000_0000_0000_0000_0010_0000_0000_0000_0000_0010,
        0b_0100_0000_0000_0000_0000_0100_0000_0000_0000_0000_0100_0000_0000_0000_0000_0100,
        0b_1000_0000_0000_0000_0000_1000_0000_0000_0000_0000_1000_0000_0000_0000_0000_1000,
        0b_0000_0000_0000_0001_0000_0000_0001_0000_0000_0001_0000_0000_0001_0000_0000_0000,
        0b_0000_0000_0000_0010_0000_0000_0010_0000_0000_0010_0000_0000_0010_0000_0000_0000,
        0b_0000_0000_0000_0100_0000_0000_0100_0000_0000_0100_0000_0000_0100_0000_0000_0000,
        0b_0000_0000_0000_1000_0000_0000_1000_0000_0000_1000_0000_0000_1000_0000_0000_0000,
        # xyz diagonal
        #                     |                   |                   |
        0b_1000_0000_0000_0000_0000_0100_0000_0000_0000_0000_0010_0000_0000_0000_0000_0001,
        0b_0001_0000_0000_0000_0000_0010_0000_0000_0000_0000_0100_0000_0000_0000_0000_1000,
        0b_0000_0000_0001_0000_0000_0000_0100_0000_0000_0010_0000_0000_0001_0000_0000_0000,
        0b_0000_0000_0000_0001_0000_0000_0010_0000_0000_0100_0000_0000_1000_0000_0000_0000
    ]


class QubicTree(Qubic, ContextTree):
    pass
